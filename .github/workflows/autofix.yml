name: autofix.ci

on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
    branches:
      - main
  push:
    branches:
      - main

permissions:
  contents: read

jobs:
  lint:
    name: Lint Fix
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Install dependencies
        run: npm ci

      - name: Prettier Format
        run: npx --yes prettier@3 --write '**/*.{graphql,yml,json,md,sh,ts,tsx,js,jsx,css}'

      - name: ESLint Fix
        run: |
          if ls -1 .eslintrc.* eslint.config.* 2>/dev/null | grep -q .; then
            npx eslint . --ext .js,.jsx,.ts,.tsx --fix || true
          else
            echo "No ESLint config found; skipping eslint --fix"
          fi

      - name: TypeScript Check
        run: npm run typecheck || true

      - name: Autofix
        uses: autofix-ci/action@635ffb0c9798bd160680f18fd73371e355b85f27

concurrency:
  group: autofix-${{github.ref}}
  cancel-in-progress: false
