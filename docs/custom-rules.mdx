---
title: Custom Rules
slug: /custom-rules
sidebar_position: 6
description: "Learn how to define custom rules and guidelines for AI agents in Forge"
sidebar_label: Custom Rules
---

# Custom Rules

Custom rules allow you to define specific guidelines and instructions that shape how AI agents behave in Forge. These rules act as persistent instructions that get injected into every AI conversation.

:::tip Looking for best practices and examples?
For comprehensive examples, team management strategies, and real-world use cases, check out our [Custom Rules Guide](/docs/custom-rules-guide).
:::

## Configuration

Custom rules can be defined in two ways:

1. **`forge.yaml` file** - For concise, structured rules in YAML format
2. **`AGENTS.md` file** - For comprehensive, markdown-formatted guidelines

Both methods work together - rules from both sources are combined and injected into the AI's system prompt.

:::tip Which Method Should I Use?

- **Just starting?** Start with `forge.yaml` for a few simple rules
- **Team project with standards?** Use `AGENTS.md` for comprehensive documentation
- **Want both?** Combine them! Use `forge.yaml` for short rules + `AGENTS.md` for detailed guidelines

Both methods work together seamlessly - Forge automatically combines rules from both sources.
:::

### Method 1: forge.yaml (For Short Rules)

Define rules in your `forge.yaml` file for concise, structured configuration.

#### Global Rules

Apply rules to all agents:

```yaml
# forge.yaml
custom_rules: |
  - Use TypeScript strict mode
  - Add error handling to all functions
  - Include unit tests for new code
  - Follow team naming conventions
```

#### Agent-Specific Rules

Apply rules to individual agents:

```yaml
# forge.yaml
agents:
  - id: frontend-specialist
    custom_rules: |
      - Use React functional components with hooks
      - Include accessibility attributes
      - Use CSS modules for styling

  - id: backend-specialist
    custom_rules: |
      - Use dependency injection for services
      - Add request/response logging
      - Validate all input with schemas
```

### Method 2: AGENTS.md (For Comprehensive Guidelines)

For detailed, project-specific guidelines, create an `AGENTS.md` file in your project root. This is ideal for:

- Comprehensive development standards
- Project-specific architecture patterns
- Detailed coding conventions
- Team workflows and best practices

**Example `AGENTS.md`:**

```markdown
## Core Development Rules

### Application Runtime

- Never restart the development server - it's already running
- Always check if services are running before starting new ones

### Code Quality Standards

- Use TypeScript strict mode for all new code
- Follow the repository pattern for data access
- Write unit tests for all business logic

### Project Structure

This is a React application with the following structure:

- `/src/components` - Reusable UI components
- `/src/services` - Business logic and API calls
- `/src/utils` - Helper functions
```

:::info
AGENTS.md supports full markdown formatting including headings, lists, code blocks, and emphasis. This makes it perfect for detailed documentation-style guidelines.
:::

**Quick Start:**

1. Create `AGENTS.md` in your project root directory
2. Write your guidelines using markdown
3. Start Forge - rules are automatically loaded

**Complete Example:**

Here's a real-world `AGENTS.md` file for a full-stack web application:

````markdown
# Development Guidelines for MyApp

## üìã Core Development Rules

### Application Runtime

- **NEVER** attempt to run the application - it's already running on port 3000 in watch mode
- The development server is persistent and handles hot reloading automatically
- Always assume the application is accessible at `http://localhost:3000`

### Package Management

- **Use**: `npm` or `npx` commands exclusively
- **Avoid**: `yarn` or `pnpm` - not used in this project
- Always check `package.json` for available scripts before running commands

### Code Quality Standards

- **TypeScript First**: All code must be type-safe with proper type definitions
- **Component Architecture**: Follow React functional components with hooks
- **Responsive Design**: Ensure all UI components work across devices
- **Error Handling**: Always wrap async operations in try-catch blocks

## üõ†Ô∏è Project Structure

```
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/      # Reusable React components
‚îÇ   ‚îú‚îÄ‚îÄ pages/           # Next.js pages
‚îÇ   ‚îú‚îÄ‚îÄ services/        # API calls and business logic
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # Helper functions
‚îÇ   ‚îî‚îÄ‚îÄ styles/          # Global styles and themes
‚îú‚îÄ‚îÄ public/              # Static assets
‚îî‚îÄ‚îÄ tests/               # Test files
```

## üéØ Development Focus Areas

### API Integration

- All API calls must go through the `services/` directory
- Use the custom `apiClient` wrapper for consistent error handling
- Never hardcode API endpoints - use environment variables

### State Management

- Use React Context for global state
- Keep component state local when possible
- Avoid prop drilling - use context or composition

### Testing

- Write unit tests for all utility functions
- Use React Testing Library for component tests
- Aim for 80% code coverage on new features

## üö´ Restrictions & Limitations

### What NOT to do:

- ‚ùå Run `npm start` or similar server commands (server is already running)
- ‚ùå Use `any` type in TypeScript
- ‚ùå Create non-responsive components
- ‚ùå Skip error handling in async functions

### What TO do:

- ‚úÖ Use existing development server
- ‚úÖ Write TypeScript-first code with proper types
- ‚úÖ Follow mobile-first responsive design
- ‚úÖ Add comprehensive error handling
- ‚úÖ Write tests for new features

## üìù Code Style

- Use functional components with hooks (no class components)
- Prefer `const` over `let`, avoid `var`
- Use arrow functions for callbacks
- Keep functions small and focused (max 50 lines)
- Use meaningful variable names (no single letters except loop counters)

## üîç Before Completing Any Task

- [ ] Code is TypeScript compliant with proper types
- [ ] Components are responsive and accessible
- [ ] Error handling is implemented
- [ ] No attempts to restart the development server
- [ ] Tests are written and passing
````

This example shows how to structure comprehensive guidelines that cover runtime behavior, code standards, project structure, and team conventions all in one place.

## Rule Format

Custom rules support:

- **Plain text instructions**
- **Markdown formatting** (lists, code blocks, emphasis)
- **Multi-line content** using YAML's `|` syntax
- **Code examples** within the rules

Example with formatting:

````yaml
custom_rules: |
  Error Handling Pattern:

  Always use this pattern:
  ```typescript
  try {
    // risky operation
  } catch (error) {
    logger.error('Operation failed:', error);
    throw new AppError('User-friendly message');
  }
  ```
````

## How It Works

When you start a Forge session:

1. **Loading**: Forge loads rules from both `forge.yaml` and `AGENTS.md` (if present)
2. **Combining**: Rules from both sources are combined together
3. **Injection**: All rules become part of the AI's system prompt
4. **Application**: AI applies all rules to every response in the session

### Rule Precedence

**Within `forge.yaml`:**

- Global `custom_rules` override agent-specific `custom_rules`

**Between `forge.yaml` and `AGENTS.md`:**

- Both sources are loaded and combined
- All rules from both files are applied to the AI's system prompt

**Example:**

```yaml
# forge.yaml - Global rule
custom_rules: "Use tabs for indentation"

agents:
  - id: frontend
    # This gets overridden by the global rule
    custom_rules: "Use 2 spaces for indentation"
```

The global rule takes precedence.

## Troubleshooting

### Rules Not Applied

**For `forge.yaml` rules:**

- Check YAML syntax (whitespace-sensitive)
- Verify `forge.yaml` is in your project root directory
- Restart Forge session to reload rules

**For `AGENTS.md` rules:**

- Verify `AGENTS.md` is in your project root directory
- Check that the file is named exactly `AGENTS.md` (case-sensitive)
- Ensure the file contains valid markdown
- Restart Forge session to reload rules

### Viewing Active Rules

Export session context to see what rules are active:

```bash
/dump html
```

This shows exactly what context (including custom rules) is sent to the AI.
