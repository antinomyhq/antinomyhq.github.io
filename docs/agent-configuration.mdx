---
title: Agent Configuration
slug: /agent-configuration
description: "Comprehensive guide for configuring AI agents in Forge"
sidebar_label: Agent Configuration
---
# Agent Configuration

Forge ships with **Muse** and **Forge** agents that handle most daily tasks, but when you need custom behavior, you can configure your own agents by defining settings like `temperature`, `model`, and system prompt.

## API reference

Agents are defined in the `forge.yaml` file under the `agents` section, let's examine each property one by one:

### id (required)

A unique identifier for your agent.

```yaml
agents:
  - id: summarizer
```

### model (required)

The model to use for responses, find available models by running `/model` command in Forge.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
```

### system_prompt (required)

System prompt or a template, the template can either be a built-in template or a custom template.

> **Note:** The `{{> templateName.hbs }}` syntax uses Handlebars partials to include template files. This allows you to reuse system prompts across multiple agents.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    
    system_prompt: "{{> summarizer.hbs }}"
```

### tools (optional)

Tools that the agent can use, check tools reference.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    tools: 
      - forge_tool_fs_read
      - forge_tool_fs_search
```

### subscribe (optional)

The list of custom commands the agent subscribes to, so whenever those custom commands are called, this agent is used for them.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    subscribe: 
      - summarize-docs
      - summarize-changes
```

### temperature (optional)

Temperature controls the randomness and creativity of the response, a lower value like `0.3` means that response would be **highly consistent and deterministic**. A higher value like `1.5` means that the response would contain more **random and creative** elements. The value of `temperature` must be between `0` and `2`.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    temperature: 1.2
```

### user_prompt (optional)

The prompt for the model, which is either the prompt the user types, or the prompt passed by a custom command the agent has subscribed to.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    ## pass the prompt as we receive it
    user_prompt: {{event.value}}
```

You can also use the prompt in a template and then pass it to the model, in cases where the received prompt itself won't make any sense:

```yaml
## event.value itself doesn't make any sense, so we add more info to make it a task
user_prompt: |
  <task>summarize the following file(s) in detail</task>
  <focus>{{event.value}}</focus>
```

### compact (optional)

Used to define context compaction settings for an agent, useful for long conversations with multiple tasks. Read context compaction for detailed implementation and reference.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    compact: 
      max_tokens: 2000
      token_threshold: 80000
      model: google/gemini-2.0-flash-001
      retention_window: 6
```

### top_p (optional)

This determines the diversity of the set of candidate tokens, must be a number between `0` and `1`. A smaller value means that response will be highly consistent and predictable, a bigger value of `top_p` means that the response will be more creative, and may include more unconventional elements.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    top_p: 0.8
```

### top_k (optional)

Very similar to `top_p` except that `top_p` takes the smallest number of tokens that have a cumulative probability *p*, while `top_k` takes *k* number of highest probability tokens, where *k* is the value provided. Value of *k* must be between `1` and `1000`, if it is not specified, the model provider's default will be used.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    top_k: 30
```

### custom_rules (optional)

Define guidelines that shape how models behave in Forge, rules defined here are used along with the rules defined in `forge.yaml`.

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    custom_rules: |
      Code Review Guidelines:
      - Check for proper error handling in all functions
      - Ensure proper documentation for public APIs
      - Verify input validation for all user-provided data
```

## Running an agent in background

If you have a helper agent that does not produce any output intended for the user to see, you can hide its output from the console, however other agents would have access to its outputs: 

```yaml
agents:
  - id: summarizer
    model: anthropic/claude-3.5-sonnet
    system_prompt: "{{> summarizer.hbs }}"
    
    hide_content: true
```

## Common issues

### Agent's responses are too random

This happens because either the `temperature` is too high or the instructions aren't clear enough. You can fix this by lowering the `temperature` so that the responses are more focused and consistent, and you can provide more clear instructions using `custom_rules` and modifying the template used in `system_prompt`.

### Agent not seeing the whole context

This happens because the base context was significantly large, and it lost important details due to a high compaction of the context. This can be fixed by reducing the compaction ratio, and changing the settings of `compact` like increasing the value of `retention_window` and `max_tokens`. You can also use a model with a large context window.

### Error rendering "Unnamed template" line 1, col 1: Partial not found summarizer.hbs

This happens because your custom template is not registered at startup and hence Forge doesn't recognize it, to solve it, define the directory containing all your custom templates using the `templates` field in `forge.yaml`:

```yaml
templates: ./myTemplates
```

### Agent does not explore different ideas and approaches

This is due to the agent being less creative, increase the value of `temperature` to make it more creative.

## Related Documentation

- [Context Compaction](../context-compaction) - Detailed guide on context management
- [Custom Rules](../custom-rules) - Define guidelines and instructions for your agents
- [Tools Reference](../tools-reference) - Available tools for agents to use